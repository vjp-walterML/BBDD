-- --------------------------------------------------------------------------------
-- BASE DE DATOS SUMINISTROS
-- 1º DAW
-- 21-03-2023
-- WALTER MARTIN LOPES
-- ------------------------------------------------------------------------------
CREATE DATABASE SUMINISTROS;
USE SUMINISTROS;

-- ================CREACION DE TABLAS================
CREATE TABLE SUMINISTRADOR (
    COD VARCHAR(10) PRIMARY KEY,
    NOMBRE VARCHAR(40),
    CIUDAD VARCHAR(40),
    CATEGORIA VARCHAR(10)
);

CREATE TABLE PRODUCTO (
    COD VARCHAR(10) PRIMARY KEY,
    NOMBRE VARCHAR(40),
    PRECIO DECIMAL(5,2)
);

CREATE TABLE SUMINISTRA (
    CODS VARCHAR(10),
    CODP VARCHAR(10),
    CANTIDAD INTEGER,
    PRIMARY KEY (CODS, CODP),
    FOREIGN KEY (CODS) REFERENCES SUMINISTRADOR(COD) ON UPDATE CASCADE ON DELETE CASCADE,
    FOREIGN KEY (CODP) REFERENCES PRODUCTO(COD) ON UPDATE CASCADE ON DELETE CASCADE
);

-- ================CARGA DE DATOS================
INSERT INTO PRODUCTO VALUES
(111,'GRAPADORA',10),
(112,'HOJAS',5),
(113,'BORRADORES',1),
(114,'LAPICES',0.5),
(115,'ARCHIVADORES',3);

INSERT INTO SUMINISTRADOR VALUES
(1,'CARLOS MARTINEZ','MADRID',5),
(2,'ADOLFO BERNAL','MADRID',4),
(3,'RODRIGO DIAZ','BARCELONA',1),
(4,'MARIA LOPEZ','SEVILLA',1);


INSERT INTO SUMINISTRA VALUES
(1,111,3),
(1,112,4),
(1,113,4),
(2,112,45),
(4,111,2),
(4,112,2),
(4,113,2),
(4,114,2),
(4,115,2);

-- ==========CONSULTAS==========
-- 1. Número y Nombre de suministradores que viven en la misma ciudad que el SUMINISTRADOR 1.
SELECT s.COD, s.NOMBRE
FROM SUMINISTRADOR s
WHERE s.CIUDAD = (SELECT CIUDAD FROM SUMINISTRADOR WHERE COD = '1');

-- 2. Nombre de los suministradores que suministran al menos un producto.
SELECT DISTINCT s.NOMBRE
FROM SUMINISTRADOR s
INNER JOIN SUMINISTRA su ON s.COD = su.CODS;

-- 3. Nombre de los suministradores que no suministran ningún producto
SELECT s.NOMBRE
FROM SUMINISTRADOR s
WHERE s.COD NOT IN (SELECT DISTINCT CODS FROM SUMINISTRA);

-- 4. Nº total de suministradores que han suministrado algún producto
SELECT COUNT(DISTINCT CODS) AS Total_Suministradores
FROM SUMINISTRA;

-- 5. Nombre de suministradores con menor categoría que el máximo de las categorías.
SELECT s.NOMBRE
FROM SUMINISTRADOR s
WHERE s.CATEGORIA < (SELECT MAX(CATEGORIA) FROM SUMINISTRADOR);
